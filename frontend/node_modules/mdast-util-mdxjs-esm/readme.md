# mdast-util-mdxjs-esm

[![Build][build-badge]][build]
[![Coverage][coverage-badge]][coverage]
[![Downloads][downloads-badge]][downloads]
[![Size][size-badge]][size]
[![Sponsors][sponsors-badge]][collective]
[![Backers][backers-badge]][collective]
[![Chat][chat-badge]][chat]

[mdast][] extensions to parse and serialize [MDX][] ESM (import/exports).

## Contents

*   [What is this?](#what-is-this)
*   [When to use this](#when-to-use-this)
*   [Install](#install)
*   [Use](#use)
*   [API](#api)
    *   [`mdxjsEsmFromMarkdown()`](#mdxjsesmfrommarkdown)
    *   [`mdxjsEsmToMarkdown()`](#mdxjsesmtomarkdown)
    *   [`MdxjsEsm`](#mdxjsesm)
    *   [`MdxjsEsmHast`](#mdxjsesmhast)
*   [HTML](#html)
*   [Syntax](#syntax)
*   [Syntax tree](#syntax-tree)
    *   [Nodes](#nodes)
    *   [Content model](#content-model)
*   [Types](#types)
*   [Compatibility](#compatibility)
*   [Related](#related)
*   [Contribute](#contribute)
*   [License](#license)

## What is this?

This package contains two extensions that add support for MDX ESM syntax in
markdown to [mdast][].
These extensions plug into
[`mdast-util-from-markdown`][mdast-util-from-markdown] (to support parsing
ESM in markdown into a syntax tree) and
[`mdast-util-to-markdown`][mdast-util-to-markdown] (to support serializing
ESM in syntax trees to markdown).

## When to use this

You can use these extensions when you are working with
`mdast-util-from-markdown` and `mdast-util-to-markdown` already.

When working with `mdast-util-from-markdown`, you must combine this package
with [`micromark-extension-mdxjs-esm`][extension].

When you are working with syntax trees and want all of MDX, use
[`mdast-util-mdx`][mdast-util-mdx] instead.

All these packages are used in [`remark-mdx`][remark-mdx], which
focusses on making it easier to transform content by abstracting these
internals away.

## Install

This package is [ESM only][esm].
In Node.js (version 16+), install with [npm][]:

```sh
npm install mdast-util-mdxjs-esm
```

In Deno with [`esm.sh`][esmsh]:

```js
import {mdxjsEsmFromMarkdown, mdxjsEsmToMarkdown} from 'https://esm.sh/mdast-util-mdxjs-esm@2'
```

In browsers with [`esm.sh`][esmsh]:

```html
<script type="module">
  import {mdxjsEsmFromMarkdown, mdxjsEsmToMarkdown} from 'https://esm.sh/mdast-util-mdxjs-esm@2?bundle'
</script>
```

## Use

Say our document `example.mdx` contains:

```mdx
import a from 'b'
export const c = ''

d
```

…and our module `example.js` looks as follows:

```js
import fs from 'node:fs/promises'
import * as acorn from 'acorn'
import {fromMarkdown} from 'mdast-util-from-markdown'
import {toMarkdown} from 'mdast-util-to-markdown'
import {mdxjsEsm} from 'micromark-extension-mdxjs-esm'
import {mdxjsEsmFromMarkdown, mdxjsEsmToMarkdown} from 'mdast-util-mdxjs-esm'

const doc = await fs.readFile('example.mdx')

const tree = fromMarkdown(doc, {
  extensions: [mdxjsEsm({acorn, addResult: true})],
  mdastExtensions: [mdxjsEsmFromMarkdown()]
})

console.log(tree)

const out = toMarkdown(tree, {extensions: [mdxjsEsmToMarkdown()]})

console.log(out)
```

…now running `node example.js` yields (positional info removed for brevity):

```js
{
  type: 'root',
  children: [
    {
      type: 'mdxjsEsm',
      value: "import a from 'b'\nexport const c = ''",
      data: {
        estree: {
          type: 'Program',
          body: [
            {
              type: 'ImportDeclaration',
              specifiers: [
                {
                  type: 'ImportDefaultSpecifier',
                  local: {type: 'Identifier', name: 'a'}
                }
              ],
              source: {type: 'Literal', value: 'b', raw: "'b'"}
            },
            {
              type: 'ExportNamedDeclaration',
              declaration: {
                type: 'VariableDeclaration',
                declarations: [
                  {
                    type: 'VariableDeclarator',
                    id: {type: 'Identifier', name: 'c'},
                    init: {type: 'Literal', value: '', raw: "''"}
                  }
                ],
                kind: 'const'
              },
              specifiers: [],
              source: null
            }
          ],
          sourceType: 'module'
        }
      }
    },
    {type: 'paragraph', children: [{type: 'text', value: 'd'}]}
  ]
}
```

```markdown
import a from 'b'
export const c = ''

d
```

## API

This package exports the identifiers
[`mdxjsEsmFromMarkdown`][api-mdxjs-esm-from-markdown] and
[`mdxjsEsmToMarkdown`][api-mdxjs-esm-to-markdown].
There is no default export.

### `mdxjsEsmFromMarkdown()`

Create an extension for [`mdast-util-from-markdown`][mdast-util-from-markdown]
to enable MDX.js ESM in markdown.

When using the [micromark syntax extension][extension] with `addResult`, nodes
will have a `data.estree` field set to an ESTree [`Program`][program] node.

###### Returns

Extension for `mdast-util-from-markdown` to enable MDX.js ESM
([`FromMarkdownExtension`][from-markdown-extension]).

### `mdxjsEsmToMarkdown()`

Create an extension for [`mdast-util-to-markdown`][mdast-util-to-markdown]
to enable MDX.js ESM in markdown.

###### Returns

Extension for `mdast-util-to-markdown` to enable MDX.js ESM
([`ToMarkdownExtension`][to-markdown-extension]).

### `MdxjsEsm`

MDX ESM (import/export) node (TypeScript type).

###### Type

```ts
import type {Program} from 'estree-jsx'
import type {Data, Literal} from 'mdast'

interface MdxjsEsm extends Literal {
  type: 'mdxjsEsm'
  data?: MdxjsEsmData | undefined
}

export interface MdxjsEsmData extends Data {
  estree?: Program | null | undefined
}
```

### `MdxjsEsmHast`

Same as [`MdxjsEsm`][api-mdxjs-esm], but registered with `@types/hast`
(TypeScript type).

###### Type

```ts
import type {Program} from 'estree-jsx'
import type {Data, Literal} from 'hast'

interface MdxjsEsmHast extends Literal {
  type: 'mdxjsEsm'
  data?: MdxjsEsmHastData | undefined
}

export interface MdxjsEsmHastData extends Data {
  estree?: Program | null | undefined
}
```

## HTML

MDX ESM has no representation in HTML.
Though, when you are dealing with MDX, you will likely go *through* hast.
